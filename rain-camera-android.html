<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#D4B896">
    <title>Rain Camera - Android</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #000;
            font-family: 'Roboto', sans-serif;
            position: fixed;
        }

        #videoContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #rainCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }

        #permissionScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #D4B896 0%, #1C1C1C 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            color: white;
            text-align: center;
            padding: 20px;
        }

        #permissionScreen.hidden {
            display: none;
        }

        .icon {
            font-size: 72px;
            margin-bottom: 24px;
        }

        h1 {
            font-size: 28px;
            font-weight: 500;
            margin-bottom: 12px;
            letter-spacing: 0.5px;
        }

        p {
            font-size: 16px;
            opacity: 0.95;
            margin-bottom: 36px;
            max-width: 320px;
            line-height: 1.5;
        }

        #startButton {
            background: white;
            color: #1C1C1C;
            border: none;
            padding: 16px 48px;
            font-size: 16px;
            font-weight: 500;
            border-radius: 28px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 20px rgba(0,0,0,0.25);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #startButton:active {
            transform: scale(0.96);
        }

        #errorMessage {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.92);
            color: white;
            padding: 24px 32px;
            border-radius: 8px;
            z-index: 100;
            display: none;
            text-align: center;
            max-width: 90%;
            font-size: 15px;
            line-height: 1.6;
        }

        #caption {
            position: fixed;
            bottom: 48px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 14px;
            text-shadow: 0 2px 12px rgba(0,0,0,0.7);
            z-index: 3;
            opacity: 0.9;
            text-align: center;
            padding: 0 20px;
        }

        .spinner {
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 42px;
            height: 42px;
            animation: spin 0.8s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .platform-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.25);
            backdrop-filter: blur(10px);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            z-index: 11;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
    </style>
</head>
<body>
    <!-- Platform Badge -->
    <div class="platform-badge">Android</div>

    <!-- Permission Screen -->
    <div id="permissionScreen">
        <div class="icon" style="font-size: 80px; font-family: serif; font-weight: 300; letter-spacing: 3px; line-height: 1;">
            <div style="font-size: 48px; margin-bottom: 10px;">â™ž</div>
            <div style="font-size: 20px; font-weight: 500; letter-spacing: 4px;">BURBERRY</div>
        </div>
        <h1>Let's Get Drenched in Burberry</h1>
        <p>Tap below to allow camera access and begin</p>
        <button id="startButton">Start</button>
    </div>

    <!-- Camera Feed -->
    <div id="videoContainer">
        <video id="video" playsinline autoplay muted></video>
    </div>

    <!-- Rain Overlay Canvas -->
    <canvas id="rainCanvas"></canvas>

    <!-- Optional Caption -->
    <div id="caption" style="display: none;">
        <!-- Add your text here if needed -->
    </div>

    <!-- Error Message -->
    <div id="errorMessage"></div>

    <script>
        class RainEffect {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d', { alpha: true });
                this.drops = [];
                this.maxDrops = 180; // More drops for Android (better GPU)
                this.init();
            }

            init() {
                this.resize();
                window.addEventListener('resize', () => this.resize());
                window.addEventListener('orientationchange', () => {
                    setTimeout(() => this.resize(), 100);
                });
                this.createDrops();
                this.animate();
            }

            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }

            createDrops() {
                this.drops = [];
                for (let i = 0; i < this.maxDrops; i++) {
                    this.drops.push(this.createDrop());
                }
            }

            createDrop() {
                return {
                    x: Math.random() * this.canvas.width,
                    y: Math.random() * this.canvas.height - this.canvas.height,
                    length: Math.random() * 22 + 10,
                    speed: Math.random() * 3.5 + 2,
                    opacity: Math.random() * 0.4 + 0.2
                };
            }

            update() {
                for (let drop of this.drops) {
                    drop.y += drop.speed;
                    
                    if (drop.y > this.canvas.height) {
                        drop.y = -drop.length;
                        drop.x = Math.random() * this.canvas.width;
                    }
                }
            }

            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                for (let drop of this.drops) {
                    // Draw thick realistic water droplet
                    const gradient = this.ctx.createLinearGradient(
                        drop.x - 2, drop.y,
                        drop.x + 2, drop.y + drop.length
                    );
                    gradient.addColorStop(0, `rgba(255, 255, 255, ${drop.opacity * 0.3})`);
                    gradient.addColorStop(0.5, `rgba(255, 255, 255, ${drop.opacity})`);
                    gradient.addColorStop(1, `rgba(200, 220, 255, ${drop.opacity * 0.6})`);
                    
                    // Main thick droplet body
                    this.ctx.beginPath();
                    this.ctx.strokeStyle = gradient;
                    this.ctx.lineWidth = 3;
                    this.ctx.lineCap = 'round';
                    this.ctx.moveTo(drop.x, drop.y);
                    this.ctx.lineTo(drop.x, drop.y + drop.length);
                    this.ctx.stroke();
                    
                    // Add highlight for realism
                    this.ctx.beginPath();
                    this.ctx.strokeStyle = `rgba(255, 255, 255, ${drop.opacity * 0.8})`;
                    this.ctx.lineWidth = 1.5;
                    this.ctx.moveTo(drop.x - 1, drop.y);
                    this.ctx.lineTo(drop.x - 1, drop.y + drop.length * 0.7);
                    this.ctx.stroke();
                    
                    // Add water droplet head (rounded top)
                    this.ctx.beginPath();
                    this.ctx.fillStyle = `rgba(255, 255, 255, ${drop.opacity * 0.9})`;
                    this.ctx.arc(drop.x, drop.y, 2, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    // Add droplet tail (tapered end)
                    this.ctx.beginPath();
                    this.ctx.fillStyle = `rgba(200, 220, 255, ${drop.opacity * 0.5})`;
                    this.ctx.arc(drop.x, drop.y + drop.length, 1.5, 0, Math.PI * 2);
                    this.ctx.fill();
                }
            }

            animate() {
                this.update();
                this.draw();
                requestAnimationFrame(() => this.animate());
            }
        }

        class CameraApp {
            constructor() {
                this.video = document.getElementById('video');
                this.permissionScreen = document.getElementById('permissionScreen');
                this.startButton = document.getElementById('startButton');
                this.errorMessage = document.getElementById('errorMessage');
                this.rainEffect = null;
                this.stream = null;

                this.startButton.addEventListener('click', () => this.requestCamera());
                
                // Handle page visibility
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden && this.stream) {
                        this.video.pause();
                    } else if (!document.hidden && this.stream) {
                        this.video.play().catch(e => console.log('Resume play error:', e));
                    }
                });

                // Prevent screen from sleeping (Android)
                this.wakeLock = null;
                this.requestWakeLock();
            }

            async requestWakeLock() {
                try {
                    if ('wakeLock' in navigator) {
                        this.wakeLock = await navigator.wakeLock.request('screen');
                        console.log('Wake Lock active');
                    }
                } catch (err) {
                    console.log('Wake Lock error:', err);
                }
            }

            async requestCamera() {
                this.startButton.innerHTML = '<div class="spinner"></div>';
                this.startButton.disabled = true;

                try {
                    // Android Chrome optimized constraints
                    const constraints = {
                        video: {
                            facingMode: 'environment',
                            width: { ideal: 1920 },
                            height: { ideal: 1080 },
                            frameRate: { ideal: 30 }
                        },
                        audio: false
                    };

                    this.stream = await navigator.mediaDevices.getUserMedia(constraints);
                    this.video.srcObject = this.stream;
                    
                    this.video.onloadedmetadata = () => {
                        this.video.play().then(() => {
                            this.permissionScreen.classList.add('hidden');
                            
                            if (!this.rainEffect) {
                                this.rainEffect = new RainEffect(document.getElementById('rainCanvas'));
                            }
                        }).catch(error => {
                            console.error('Video play error:', error);
                            this.showError('Unable to start camera. Please try again.');
                            this.startButton.innerHTML = 'Try Again';
                            this.startButton.disabled = false;
                        });
                    };

                } catch (error) {
                    console.error('Camera access error:', error);
                    this.showError(this.getErrorMessage(error));
                    this.startButton.innerHTML = 'Try Again';
                    this.startButton.disabled = false;
                }
            }

            getErrorMessage(error) {
                if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                    return 'Camera access denied.\n\nPlease allow camera permission when prompted, or check your browser settings.';
                } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
                    return 'No camera found on this device.';
                } else if (error.name === 'NotReadableError' || error.name === 'TrackStartError') {
                    return 'Camera is already in use.\n\nPlease close other apps using the camera and try again.';
                } else if (error.name === 'SecurityError') {
                    return 'Camera blocked for security reasons.\n\nPlease ensure you\'re using HTTPS.';
                } else {
                    return 'Unable to access camera.\n\nPlease check your permissions and try again.';
                }
            }

            showError(message) {
                this.errorMessage.textContent = message;
                this.errorMessage.style.display = 'block';
                setTimeout(() => {
                    this.errorMessage.style.display = 'none';
                }, 6000);
            }
        }

        // Initialize app
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => new CameraApp());
        } else {
            new CameraApp();
        }

        // Lock screen orientation to portrait (optional)
        if (screen.orientation && screen.orientation.lock) {
            screen.orientation.lock('portrait').catch(err => {
                console.log('Orientation lock not supported:', err);
            });
        }
    </script>
</body>
</html>
